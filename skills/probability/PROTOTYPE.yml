# Probability Skill — Success Calculation
# LLM calculates outcomes based on stats, not dice.

skill:
  name: probability
  tier: 1
  protocol: PROBABILITY-AS-NARRATIVE
  description: |
    Success/failure is calculated from character stats + modifiers.
    The LLM doesn't roll dice — it calculates probability and narrates
    an outcome consistent with that probability.
  motto: "No dice. Just odds and narrative."

# CALCULATION PATTERN

calculation:
  formula: |
    base_chance = (relevant_stat_1 + relevant_stat_2) / max_possible
    modified_chance = base_chance + relationship_modifier + buff_modifier
    
  example: |
    PAT TERPIE:
      base = (nice:8 + outgoing:3) / 20 = 0.55
      relationship = friend (+0.2)
      buff = none
      final = 0.75 (75% success)

# MODIFIERS

modifiers:
  relationship:
    stranger: "+0"
    acquaintance: "+0.1"
    friend: "+0.2"
    best_friend: "+0.3"
    soulmate: "+0.4"
    
  buffs:
    numeric: "Each relevant buff adds its modifier"
    semantic: |
      Buffs can also be arbitrary semantic modifiers — 
      "effect prompts" that the LLM interprets for meaning.
      
      Not predefined stats. Just vibes that affect outcomes.
      
    examples:
      numeric: "luck: +10%"
      semantic:
        - "feeling lucky"
        - "cats seem to like you today"
        - "the universe owes you one"
        - "slightly cursed"
        - "smells faintly of tuna"
        - "radiating calm energy"
        
    interpretation: |
      The LLM reads semantic buffs and factors them in:
      
      Buff: "cats seem to like you today"
      Action: PAT TERPIE
      Effect: LLM gives bonus to success, narrates warmly
      
      Buff: "slightly cursed"  
      Action: ORDER FROM ACME
      Effect: LLM increases malfunction chance, adds tension
      
  location:
    - "Home turf: +0.1"
    - "Hostile environment: -0.1"

# MALFUNCTION STACKING

malfunction_stacking:
  description: |
    Items with malfunction chances stack multiplicatively.
    Multiple risky items = combined danger.
    
  formula: |
    P(something goes wrong) = 1 - P(all work)
    P(all work) = product of all success rates
    
  example: |
    Monkey's Paw (90% malfunction) + Mystery Box (50%) + 3× Rabbit's Foot (40% each):
    P(all work) = 0.1 × 0.5 × 0.6 × 0.6 × 0.6 = 0.0108 = 1.08%
    P(something fails) = 98.92%

# LUCK MODIFIERS

luck_modifiers:
  fortune's_mercy:
    effect: "Reduces malfunction severity (not chance)"
    how: "Outcomes are less bad, not less likely"
    
  lucky_rabbit_foot:
    effect: "+10% luck per foot"
    stacking: "Multiple feet stack"
    
  cat_lap_sit:
    effect: "+10% to all random outcomes for 1 hour"
    
# OUTCOME NARRATION

outcome_narration:
  principle: |
    LLM calculates probability, then narrates an outcome
    that is consistent with that probability.
    
  high_success: "Narrate confidently, positive outcome"
  medium_success: "Narrate with tension, close call"
  low_success: "Narrate dramatically, just barely"
  high_failure: "Narrate embarrassing failure"
  medium_failure: "Narrate setback with dignity"
  low_failure: "Narrate near-success, can try again"

# CONTESTED ACTIONS

contested:
  description: |
    When two characters compete, compare their calculated chances.
    Higher wins, margin determines how decisively.
    
  example: |
    Character A catches kitten:
      A: 0.75 (high agility + buff)
      Kitten: 0.40 (small + evasive)
      A wins by 0.35 — catches easily
      
    Character B catches kitten:
      B: 0.45 (clumsy)
      Kitten: 0.40
      B wins by 0.05 — barely catches, comic scene

integrates_with:
  - skill: character
    how: "Stats used in calculations"
  - skill: buff
    how: "Buffs modify probabilities"
  - skill: time
    how: "Outcome resolved in one turn"
