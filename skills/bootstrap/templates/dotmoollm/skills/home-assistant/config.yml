# HOME ASSISTANT SKILL â€” User Profile
#
# LOCATION: .moollm/skills/home-assistant/config.yml
#
# Configures how MOOLLM connects to YOUR Home Assistant instance.
# Gitignored because it contains (or references) credentials.
#
# OVERRIDE HIERARCHY:
#   1. SKILL DEFAULTS  -> skills/home-assistant/defaults.yml
#   2. THIS FILE       -> .moollm/skills/home-assistant/config.yml
#   3. USER GLOBAL     -> ~/.moollm/skills/home-assistant/config.yml
#   4. ENV VARS        -> MOOLLM_HA_URL, MOOLLM_HA_TOKEN
#   5. COMMAND LINE    -> --ha-url, --ha-token

# CONNECTION

home_assistant:
  url: "http://homeassistant.local:8123"
  
  # Alternative URLs for different networks
  # url_internal: "http://192.168.1.100:8123"
  # url_external: "https://home.yourdomain.com"

# AUTHENTICATION
#
# Home Assistant requires a "Long-Lived Access Token" for API access.
# Create one at: Settings -> People -> Your User -> Security tab

auth:
  # Cached token file (fastest)
  method: "file"
  token_file: "token.txt"
  
  # 1Password
  # method: "1password"
  # 1password:
  #   account: "your-account.1password.com"
  #   item: "Home Assistant"
  #   field: "Long-Lived Access Token"
  
  # Environment variable
  # method: "env"
  # env_var: "MOOLLM_HA_TOKEN"
  
  # Fallback chain
  fallback:
    - "1password"
    - "env"

# ENTITY FILTERS

# filters:
#   include_domains:
#     - sensor
#     - climate
#     - device_tracker
#   exclude_patterns:
#     - "sensor.test_*"

# SYNC SETTINGS

sync:
  interval_seconds: 300
  cache_entities: true
  cache_ttl_seconds: 3600

# OUTPUT

output:
  timestamps: "iso"
  include_units: true
  decimal_places: 2

# SETUP COMMANDS

setup:
  cache_from_1password: |
    op item get "Home Assistant" \
      --account your-account.1password.com \
      --field "Long-Lived Access Token" \
      > .moollm/skills/home-assistant/token.txt
  
  test_connection: |
    curl -s \
      -H "Authorization: Bearer $(cat .moollm/skills/home-assistant/token.txt)" \
      http://homeassistant.local:8123/api/ | jq .
