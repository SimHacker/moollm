# CARD.yml — Advertisement
#
# Objects announce what they can do — The Sims style.
# "Objects don't wait to be used — they announce what's possible."
#
# FUNDAMENTAL ARCHITECTURE:
# Advertisements are NOT just for skills or objects — they can be ANYWHERE:
#   - A room can advertise (ROOM.yml)
#   - A character can advertise (CHARACTER.yml)
#   - A YAML section can advertise inline (inventory.magic_sword.advertisements)
#   - Any file, any directory, any nested structure
#
# An advertisement is a LEXICALLY SCOPED AGENT:
#   - Captures its environment (the directory, the object's state)
#   - Responds to patterns (triggers)
#   - Can create side effects (files, messages, state changes)
#   - Or just returns a value
#
# The "event" doesn't have to be reified — it can be:
#   - A word in chat
#   - A concept
#   - A delegated method from another skill
#   - A need state
#   - Just... a message
#
# See: kernel/ARCHITECTURE.md → "The Universal Foundation: Agents All The Way Down"
# See: designs/MOO-HERITAGE.md → "Advertisements Are Everywhere"

card:
  name: ADVERTISEMENT
  type: [skill, interaction, game]
  tier: 1
  invoke_when: ["Need objects to announce actions", "Build plug-in interactions"]
  advertisement_names:
    - DISCOVER-ACTIONS
    - BUILD-OBJECT
    - UNDERSTAND-SIMS
  related:
    - skills/action-queue
    - skills/room
    - skills/needs
    - skills/card
    - skills/coherence-engine
    - skills/rubric
  tags: [moollm, sims, interaction, advertisement]
  description: |
    Sims-style object interaction: every object broadcasts available actions,
    scored by relevance. Use for plug-in architectures where objects
    self-describe behaviors. "Objects don't wait to be used — they announce
    what's possible."

# TOOLS REQUIRED

tools:
  required:
    - read_file   # Read object advertisements
    - write_file  # Update ad scores/state
    - list_dir    # Find objects in room
  optional: []

methods:
  SCAN:
    description: "Collect all advertisements from current room"
    parameters:
      room: "Path to room (defaults to current)"
    output: chat
    effect: "Read *.yml, extract ads, score and sort"

  SHOW:
    description: "Display what an object advertises"
    parameters:
      object: "Object to inspect"
    output: chat
    effect: "Show object's ads with scores"

  SELECT:
    description: "Choose an advertised action"
    parameters:
      object: "Object offering the action"
      action: "Action to take"
    output: chat + state-change
    effect: "Execute the action; may queue more actions"

  EVALUATE:
    description: "Score ads against character needs"
    parameters:
      character: "Character to score for"
    output: chat
    effect: "Adjust scores based on needs/goals/context"

# STATE
# Advertisements are declared in object files, not here

state:
  # Ads live on objects; this card has no persistent instance state.
  advertisement-schema:
    action:
      type: string
      description: "Action name (CRAFT, EXAMINE, USE, AMBIENT, etc.)"
    description:
      type: string
      description: "What the action does"
    preconditions:
      type: array
      description: "What must be true for action to be available"
    score:
      type: integer
      description: "Base score (0-100)"
    score-if:
      type: string
      description: "Condition that modifies score"
    satisfies:
      type: array
      description: "What needs/goals this action satisfies"

# SPECIAL ADVERTISEMENT: AMBIENT
# Skills can advertise "I want to be in context" using AMBIENT

ambient-advertisement:
  description: |
    AMBIENT is a special advertisement type for skills that should be
    "in the air" — always available, always shaping output without
    explicit invocation. Like air filters that clean continuously.
    
  schema:
    AMBIENT:
      score:
        type: integer
        range: [0, 100]
        description: "Priority for context budget allocation"
      condition:
        type: string
        options: [always, condition-string]
        description: "'always' or a condition the orchestrator evaluates"
      scope:
        type: string
        options: [session, conversation, room, card-only]
        description: "How long the ambient effect persists"
      resolution:
        type: string
        options: [full, summary, sniff, card-only]
        description: "How much of the skill to keep in context"
        
  examples:
    always-on: |
      # no-ai-slop: Syntactic hygiene
      AMBIENT:
        score: 100
        condition: always
        scope: session
        resolution: card-only
        
    conditional: |
      # yaml-jazz: When writing YAML
      AMBIENT:
        score: 90
        condition: "when writing or editing YAML files"
        scope: conversation
        resolution: summary
        
  orchestrator-behavior: |
    The orchestrator:
    1. Collects all AMBIENT advertisements from loaded skills
    2. Evaluates conditions against current context
    3. Sorts by score (highest priority first)
    4. Loads skills at their declared resolution until context budget exhausted
    5. Refreshes on context change (new room, new topic, etc.)
    
  # DESIGN DECISION: Why AMBIENT lives in CARD.yml, not AMBIENT.yml
  
  design-decision:
    title: "AMBIENT in CARD, not separate file"
    date: "2026-01-24"
    
    considered: |
      A layered wake-up system with AMBIENT.yml:
      - Compressed activation file (always paged in)
      - Triggers loading SKILL.md → resources → templates  
      - Dynamic scoring, context gates, resource bundles
      
    rejected-because:
      - "Requires smart orchestrator we don't control (Cursor, Claude Code)"
      - "CARD.yml already serves as sniffable interface"
      - "Adds complexity without current runtime support"
      - "Advertisement metaphor already captures the intent"
      
    pragmatic-solution: |
      "Throw down the gauntlet" architecture:
      1. Declare AMBIENT in CARD.yml — skill advertises its ambient nature
      2. Manual hot list — keep CARDs in .moollm/hot.yml or working set
      3. Resolution field — skill declares how much to page in
      4. Trust the LLM — once CARD is in context, constraints apply
      
    future: |
      When we build our own orchestrator (MOOCO), AMBIENT.yml becomes viable.
      For now: CARD.yml + hot list is the pragmatic path.

# ADVERTISEMENTS
# What this card offers (yes, it advertises its own advertisements)

advertisements:
  DISCOVER-ACTIONS:
    score: 90
    condition: "New room or unsure what to do"
    effect: "Scan and list ads with scores"
    delegate:
      method: SCAN
      params:
        room: "{{room|.}}"
  BUILD-OBJECT:
    score: 85
    condition: "Creating an object that needs interactions"
    effect: "Show example ad schema and scoring"
    delegate:
      method: SHOW
      params:
        object: "{{object|example}}"
  UNDERSTAND-SIMS:
    score: 75
    condition: "Learning how Sims-style interaction works"
    effect: "Explain advertisement system and scoring"
    delegate:
      method: EVALUATE
      params:
        character: "{{character|player}}"

# THE SIMS SECRET SAUCE
# Why this pattern enabled massive expansion

sims-insight:
  why-it-worked:
    - "User-created objects — anyone could make new furniture/items"
    - "Expansion packs — drop in new objects with advertisements"
    - "No code changes — objects self-describe behaviors"
    - "Infinite variety — community created millions of objects"
    
  moollm-parallel:
    - "YAML files self-describe capabilities"
    - "New skills/objects plug in without changing core"
    - "LLM reads descriptions, figures out interactions"
    - "Community can share object definitions"

# PIE MENU INTEGRATION

pie-menu:
  description: "Advertisements naturally map to pie menus"
  behavior: |
    When player clicks an object, advertisements become
    pie menu slices, sorted by score, highest at top.
    
    Just like Don Hopkins' original pie menus: fast access
    to contextually-relevant actions.

# RELATED

see-also:
  - skills/action-queue    # Actions get queued from ads
  - skills/room            # Where objects live
  - skills/needs           # Scores adjusted by needs
  - skills/card            # Cards have advertisements too
  - skills/coherence-engine # Orchestrates ad evaluation
  - skills/rubric          # Structured scoring criteria

# CREDITS

credits:
  inspiration:
    - "Will Wright — The Sims advertisement system"
    - "Don Hopkins — Pie Menus"
  lineage:
    - "The Sims (2000) — original implementation"
    - "HyperCard — objects handle their own events"
