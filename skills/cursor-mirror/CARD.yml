card:
  id: cursor-mirror
  name: "Cursor Mirror"
  type: [skill, introspection, utility]
  emoji: "ðŸ”®"
  tier: 2
  tagline: "Watch yourself think."
  description: |
    Introspect Cursor session state: chats, tool calls, context assembly,
    and agent behavior. Powered by cursor_mirror.py.

methods:
  STATUS: { signature: "status" }
  TREE: { signature: "tree [path]" }
  TOOLS: { signature: "tools <ref>" }
  THINKING: { signature: "thinking <ref>" }
  CONTEXT_SOURCES: { signature: "context-sources <ref>" }
  TIMELINE: { signature: "timeline <ref>" }
  TRANSCRIPT: { signature: "transcript <ref>" }
  EXPORT_MARKDOWN: { signature: "export-markdown <ref>" }

invoke_when:
  - "Review past Cursor chats"
  - "Trace context assembly"
  - "Debug agent behavior"
  - "Summarize sessions"

references:
  details: "skills/cursor-mirror/SKILL.md"

# Contribution Staging Methods

staging_methods:
  PREFS-INCLUDE:
    signature: "prefs include <skill> <example>"
    description: "Remove exclusion â€” include example again"
    
  STAGE-ADD:
    signature: "stage add <skill> <local-example>"
    description: "Stage a local preference for contribution"
    behavior: |
      1. Copies from .moollm/skills/<skill>/examples/
      2. Places in skills/<skill>/examples/ (repo, not gitignored)
      3. Marks as staged in .moollm/staged.yml
      
  STAGE-LIST:
    signature: "stage list"
    description: "Show staged contributions"
    
  STAGE-CONSOLIDATE:
    signature: "stage consolidate <staged-file> <existing-file>"
    description: "Merge staged example with one already in repo"
    note: "For when your example overlaps with existing"
    
  STAGE-UNSTAGE:
    signature: "stage unstage <file>"
    description: "Remove from staging (move back to local)"
    
  STAGE-COMMIT:
    signature: "stage commit [--branch NAME]"
    description: "Thoughtful commit of staged contributions"
    behavior: |
      1. Creates branch if needed (default: contrib/<date>-<skill>)
      2. Analyzes staged files
      3. Generates semantic commit message
      4. Commits with proper attribution
      
  STAGE-PR:
    signature: "stage pr [--title TITLE]"
    description: "Create PR from staged contributions"
    behavior: |
      1. Pushes branch
      2. Generates PR title and body from staged content
      3. Creates PR via gh cli
      4. Returns PR URL

# ADVERTISEMENTS

advertisements:
  CHAT-CATALOG:
    score: 100
    condition: "Outline conversation topics, plan commits, summarize session"
    
  WATCH-YOURSELF-THINK:
    score: 100
    condition: "Meta-cognition, review reasoning, self-awareness"
    
  ANALYZE-BOOT:
    score: 100
    condition: "Analyzing MOOLLM boot sequence or agent behavior"
    
  TRACE-CONTEXT:
    score: 95
    condition: "Understanding how Cursor assembles context"
    
  STATUS-CHECK:
    score: 95
    condition: "Checking Cursor health, configuration, or limits"
    
  NAVIGATE-HISTORY:
    score: 95
    condition: "Navigating workspaces and composers hierarchically"
    
  TRACE-MCP:
    score: 90
    condition: "Tracing MCP tool calls or server usage"
    
  DOTCURSOR-EXPLORE:
    score: 90
    condition: "Exploring ~/.cursor, AI tracking, transcripts"
    
  IMAGE-ARCHAEOLOGY:
    score: 85
    condition: "Finding cached images, screenshots, galleries"
    
  EXPORT-DOCS:
    score: 80
    condition: "Documenting conversations, creating session logs"
    
  SQL-QUERY:
    score: 85
    condition: "Querying Cursor databases directly"
    
  OPTIMIZE:
    score: 95
    condition: "Compile user prefs + skill examples into optimized context"
    
  PREFS-MANAGE:
    score: 90
    condition: "Manage local preferences, exclusions, custom examples"
    
  STAGE-CONTRIBUTE:
    score: 85
    condition: "Stage local prefs for contribution, commit, PR"

# SISTER SCRIPT

script:
  name: scripts/cursor_mirror.py
  language: python3
  lines: ~9800
  commands: 59
  output_formats: [text, json, jsonl, yaml, csv, md]

# FAMILIAR

familiar:
  name: "Cursor"
  emoji: "ðŸ”®"
  file: characters/I-BEAM-CHARACTER.yml
  invocation: ["Cursor, [question]", "ðŸ”® [question]"]

# OUTPUTS â€” What cursor-mirror produces

outputs:
  config_dir: ".moollm/skills/cursor-mirror/"
  
  probe_cache:
    path: ".moollm/skills/cursor-mirror/probe-cache.yml"
    generates: "cursor-mirror status --yaml"
    note: "Cached status for fast boot"
    
  exports:
    transcripts: ".moollm/skills/cursor-mirror/transcripts/*.md"
    galleries: ".moollm/skills/cursor-mirror/galleries/*.md"
    indexes: ".moollm/skills/cursor-mirror/index/"
    
  formats:
    - text    # Human-readable tables (default)
    - json    # Compact JSON for APIs
    - jsonl   # JSON Lines for streaming
    - yaml    # YAML Jazz for configs
    - csv     # Spreadsheets (union of all keys)
    - md      # Smart markdown (tables + outlines)

# TOOLS

tools:
  required: [read_file, terminal]
  optional: [grep, glob]

# DATA SOURCES â€” Where Cursor stores everything
# See storage/*.yml for platform-specific paths

data_sources:
  # Application Support (structured SQLite)
  app_support:
    macos: "~/Library/Application Support/Cursor/"
    linux: "~/.config/Cursor/"
    windows: "%APPDATA%\\Cursor\\"
    
    databases:
      global:
        path: "User/globalStorage/state.vscdb"
        size: "~9 GB"
        tables:
          cursorDiskKV:              # Primary chat storage
            keys:
              - "bubbleId:*:*"       # Chat messages (50k+ keys)
              - "agentKv:*:*"        # Tool results cache (25k+ keys)
              - "checkpointId:*:*"   # File snapshots (10k+ keys)
              - "messageRequestContext:*:*"  # Context assembly
          ItemTable:                 # Config and state
            keys:
              - "cursorai/*"         # Server config, feature flags
              - "mcpService.*"       # MCP server registry
              - "aiCodeTracking*"    # AI attribution data
              
      workspace:
        pattern: "User/workspaceStorage/<hash>/state.vscdb"
        contains:
          - "composer.composerData"  # Conversation metadata
          - "aiService.prompts"      # Prompt history
          - "aiService.generations"  # Generation log
          - "history.entries"        # Editor history
          
    indexing:
      pattern: "User/workspaceStorage/<hash>/anysphere.cursor-retrieval/"
      files:
        - "embeddable_files.txt"              # Files sent to embedding server
        - "high_level_folder_description.txt" # Important paths for retrieval
        
    images:
      pattern: "User/workspaceStorage/<hash>/images/*.png"
      note: "Cached images from chats â€” findable via IMAGE-GALLERY"

  # ~/.cursor (plaintext projects data)
  dotcursor:
    path: "~/.cursor/"
    
    config:
      - "argv.json"           # CLI args, crash reporter
      - "mcp.json"            # Global MCP server definitions
      - "settings.json"       # Terminal profiles
      - "ide_state.json"      # Cross-workspace MRU
      
    ai_tracking:
      path: "ai-tracking/ai-code-tracking.db"
      size: "~80 MB"
      tables:
        - "ai_code_hashes"    # 274k+ rows â€” every AI-generated line
        - "scored_commits"    # Git commits with AI attribution %
        - "tracking_state"    # Tracking start time
        
    extensions:
      path: "extensions/"
      size: "~1.3 GB"
      manifest: "extensions/extensions.json"
      pattern: "extensions/<publisher>.<name>-<version>[-<platform>]/"
      
    projects:
      pattern: "projects/<workspace-path-dashed>/"
      contents:
        agent_transcripts:
          pattern: "agent-transcripts/<composer-uuid>.txt"
          note: "REAL-TIME plaintext transcripts â€” updated as you chat!"
          format: |
            user:
            <user_query>prompt</user_query>
            
            assistant:
            [Thinking] reasoning...
            [Tool call] ToolName
            [Tool result] output...
            
        agent_tools:
          pattern: "agent-tools/<uuid>.txt"
          note: "Cached tool outputs"
          
        terminals:
          pattern: "terminals/<id>.txt"
          note: "Terminal state snapshots (ext-* = external terminals)"
          format: |
            ---
            pid: 12345
            cwd: /path/to/dir
            last_command: ls -la
            ---
            ...output...
            
        mcps:
          pattern: "mcps/<server-name>/tools/<tool>.json"
          note: "MCP tool schemas per server"

  # Key patterns for SQL queries
  key_patterns:
    bubbles: "bubbleId:<composerId>:<messageId>"
    tools: "agentKv:<composerId>:<toolCallId>"
    checkpoints: "checkpointId:<uuid>:<filePath>"
    context: "messageRequestContext:<composerId>:<messageId>"

# DOCUMENTATION â€” Organized by purpose

files:
  # Core (always read)
  core:
    - CARD.yml       # This file â€” sniffable interface
    - SKILL.md       # Full protocol, command reference, K-REF format
    - README.md      # Landing page for humans, I-Beam familiar docs
    
  # Scripts directory
  scripts/:
    - cursor_mirror.py  # 59 commands, ~9800 lines, Python 3.8+
    - bundle.sh         # Creates distribution bundle
    
  # Reference docs â€” technical schemas and catalogs
  reference/:
    DATA-SCHEMAS.yml:       # bubble, composer, tool_call, context schemas
      contents: [bubble, composer, prompt, generation, tool_call, context]
      size: "700+ lines"
    DOTCURSOR-SCHEMAS.yml:  # ~/.cursor JSON formats
      contents: [ai_code_hashes, agent_transcript, mcp_cache]
    KEY-CATALOG.yml:        # Complete cursorDiskKV + ItemTable inventory
      contents: [bubbleId, agentKv, checkpointId, aiCodeTracking, ...]
      total_keys: "102,724 documented"
    TOOLS-CATALOG.yml:      # All 29 Cursor agent tools with schemas
      contents: [read_file, write, search_replace, grep, mcp_*, ...]
      total_calls_analyzed: "19,789"
    MODELS.yml:             # AI model registry and routing
    ORCHESTRATION.yml:      # Feature flags, server limits, config cache
    CURSOR-EXTENSIONS.yml:  # Extension inventory and paths
    EXTERNAL-SERVICES.yml:  # API endpoints (repo42, etc.)
    NATIVE-MODULES.yml:     # Node.js native module inventory
    
  # Storage paths â€” platform-specific locations
  storage/:
    MAC-STORAGE.yml:        # ~/Library/Application Support/Cursor/
    LINUX-STORAGE.yml:      # ~/.config/Cursor/
    WINDOWS-STORAGE.yml:    # %APPDATA%\Cursor\
    DOTCURSOR-STORAGE.yml:  # ~/.cursor/ (cross-platform)
    MAC-CURSOR-APP.yml:     # /Applications/Cursor.app bundle
    
  # Config templates â€” copy and customize
  templates/:
    cursor_mirror_config.yml:  # Default configuration
    default-ignore.yml:        # Paths/patterns to skip in scans
    snitch-ignore.yml:         # Security scanner false positive filters
    
  # Examples â€” reference patterns
  examples/:
    patterns.yml:           # Audit pattern definitions (regex, glob, literal)
    
  # Character definitions
  characters/:
    I-BEAM-CHARACTER.yml:   # I-Beam familiar â€” 826 lines of personality
      methods: [EXPLAIN, PROBE, ANALYZE, TRACE, SEARCH, REMEMBER, REFLECT, TEACH]
      clippy_disasters: 12  # Why Clippy is unavailable
      
  # Gallery
  gallery/:
    IMAGE-GALLERY.md:       # Curated gallery of 25+ session images
      categories: [Sims Code, MOOLLM Diagrams, People, Infrastructure, DevTools]
