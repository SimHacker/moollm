# MOOLLM Card Object Model
# Cards as first-class MOOLLM objects with inheritance, embedding, and instances
#
# "A card is a card is a card... until you play it. Then it's YOUR card."

card_object_model:
  name: "MOOLLM Card Object Model"
  
  philosophy: |
    A Fluxx card is a MOOLLM object. It follows the same patterns:
    
    1. DEFINITION â€” The card as type/template (in a pack, in a file, inline)
    2. REFERENCE â€” A pointer to a card you "have" (in inventory, with annotations)
    3. INSTANCE â€” A card as played into a specific context (game, room, conversation)
    
    You don't need CARD.yml files for every card.
    Cards can be embedded in packs, defined inline, generated dynamically.
    Each layer can add customizations, annotations, state.
    
    The card in your hand is not the same object as the card definition.
    It INHERITS from it. And when you play it, THAT instance inherits from yours.
    
    It's turtles all the way down. And each turtle can have a hat.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# THE THREE LAYERS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

layers:

  definition:
    name: "Card Definition"
    description: "The card as template/type"
    
    where_it_lives:
      - "In a card pack YAML (cards/amsterdam-expansion.yml)"
      - "In a cardset file (cardsets/fluxx-4.0.yml)"
      - "Inline in conversation (YAML data island)"
      - "Dynamically generated by LLM"
      - "NOT required to be a separate file!"
      
    what_it_contains:
      - "id: unique identifier"
      - "name: display name"
      - "type: keeper|goal|action|rule|creeper"
      - "emoji: visual icon"
      - "flavor: description text"
      - "effects: what it does"
      - "image_prompt: for generation"
      
    example:
      embedded_in_pack: |
        # In cards/amsterdam-expansion.yml
        keepers:
          stroopwafel:
            name: "Stroopwafel"
            emoji: "ğŸ§‡"
            flavor: "Caramel perfection"
            # This IS the definition. No separate file needed.
            
      inline_in_conversation: |
        # Dynamically created during play
        ```yaml
        card:
          id: "improvised-cheese-shield"
          name: "Improvised Cheese Shield"
          type: "action"
          emoji: "ğŸ§€ğŸ›¡ï¸"
          flavor: "Don's emergency defense"
          effect: "Negate one action targeting you. Discard a food Keeper."
          origin: "Invented by Don, Hand 7, 2026-01-23"
          # Born in conversation, just as valid!
        ```
        
  reference:
    name: "Card Reference (Inventory)"
    description: "A card you 'have' â€” pointer with customizations"
    
    what_it_is: |
      When you "have" a card (in your hand, inventory, collection),
      you don't have a copy of the definition. You have a REFERENCE
      that can carry your own annotations, state, and history.
      
    structure:
      ref: "amsterdam-expansion:stroopwafel"  # Pointer to definition
      # Plus any instance-specific data:
      annotations: "optional personal notes"
      history: "optional provenance"
      customizations: "optional overrides"
      
    examples:
      simple_reference: |
        # Just a pointer â€” most common
        - ref: "amsterdam-expansion:stroopwafel"
        
      annotated_reference: |
        # With personal notes
        - ref: "amsterdam-expansion:stroopwafel"
          annotations:
            acquired: "Gift from Don, Session 42"
            memories: "The one that won me the Gezellig Evening goal"
            nickname: "Lucky Wafel"
            
      customized_reference: |
        # With overrides (rare, powerful)
        - ref: "moollm-tech-pack:yaml_jazz"
          customizations:
            flavor: "Comments carry semantic weight. I FELT this one."
            special_ability: "When I play this, I draw 2 instead of 1."
          origin: "Don's signed copy, with house rules"
          
  instance:
    name: "Card Instance (In Play)"
    description: "A card as it exists in a specific context"
    
    what_it_is: |
      When you PLAY a card, you create an INSTANCE of your reference.
      This instance exists in the game state, room, or conversation.
      It inherits from your reference (which inherits from definition).
      It can have its own state: where it is, what's happened to it.
      
    structure:
      inherits: "ref to your reference"
      context: "where it's played (game, room, conversation)"
      state: "instance-specific state"
      played_by: "who played it"
      played_at: "when"
      
    example: |
      # In a game state array
      keepers_in_play:
        - inherits: "palm:inventory:stroopwafel"
          context: "moollm-ultimate-001"
          played_by: "palm"
          played_at: "hand_5_turn_2"
          position: "palm_keepers[0]"
          state:
            warm: true  # Been sitting on coffee
            
        - inherits: "don:inventory:yaml_jazz"
          context: "moollm-ultimate-001"
          played_by: "don"
          played_at: "hand_5_turn_4"
          position: "don_keepers[2]"
          state:
            k_line_resonance: 1.0  # Don recognized his own ideology

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# YAML DATA ISLANDS â€” Cards in Conversation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

yaml_data_islands:

  concept: |
    Cards can appear INLINE in conversation as YAML code blocks.
    They don't need to be in files. They exist as data islands
    in the session markup. The LLM can generate them, reference them,
    play them, and track their state â€” all within the conversation.
    
  syntax: |
    ```yaml
    card:
      id: "session-generated-card"
      name: "Lightning Bolt of Insight"
      type: "action"
      emoji: "âš¡ğŸ’¡"
      # ... full card definition ...
    ```
    
  examples:
  
    dynamic_generation: |
      **User:** Make me a card that represents this moment!
      
      **LLM:** 
      ```yaml
      card:
        id: "moment-of-clarity-20260123"
        name: "Moment of Clarity"
        type: "action"
        emoji: "âœ¨ğŸ§ "
        flavor: "Everything clicks into place."
        effect: "Look at all Goals in the deck. Choose one to put on top."
        origin:
          session: "fluxx-chaos-session-47"
          timestamp: "2026-01-23T15:42:00Z"
          inspired_by: "Don's realization about card inheritance"
      ```
      
      This card now exists! You can reference it, play it, keep it.
      
    playing_into_game: |
      **LLM (during game):**
      
      Palm plays Stroopwafel.
      
      ```yaml
      play_event:
        action: "play_keeper"
        player: "palm"
        card:
          inherits: "amsterdam-expansion:stroopwafel"
          instance_id: "game-001-keeper-017"
          state:
            in_play: true
            owner: "palm"
            position: 2
      ```
      
      The stroopwafel is now on the table in front of Palm.
      
    card_with_history: |
      **LLM (narrating):**
      
      Don plays the legendary YAML Jazz card â€” the same one he's
      carried since Adventure 2.
      
      ```yaml
      play_event:
        action: "play_keeper"
        player: "don"
        card:
          inherits: "don:inventory:yaml-jazz-original"
          instance_id: "game-001-keeper-023"
          state:
            in_play: true
            owner: "don"
          provenance:
            acquired: "Adventure 2, The Coatroom"
            sessions_played: 47
            wins_contributed_to: 12
            annotations:
              - "The one that started it all"
              - "Comments carry semantic weight â€” I wrote those words"
      ```
      
      The other players feel the history radiating from it.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INHERITANCE MODEL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

inheritance:

  chain: |
    Definition â†’ Reference â†’ Instance
    
    Each layer inherits from the previous.
    Each layer can add/override properties.
    Resolution goes child â†’ parent until found.
    
  example: |
    DEFINITION (amsterdam-expansion:stroopwafel):
      name: "Stroopwafel"
      emoji: "ğŸ§‡"
      flavor: "Caramel perfection"
      
    REFERENCE (palm:inventory:stroopwafel):
      inherits: "amsterdam-expansion:stroopwafel"
      annotations:
        nickname: "Lucky Wafel"
        # name, emoji, flavor inherited from definition
        
    INSTANCE (game-001-keeper-017):
      inherits: "palm:inventory:stroopwafel"
      state:
        warm: true
        in_play: true
        owner: "palm"
        # nickname inherited from reference
        # name, emoji, flavor inherited from definition
        
  resolution: |
    When you ask "what's the flavor of this card?":
    
    1. Check instance â†’ not found
    2. Check reference â†’ not found
    3. Check definition â†’ "Caramel perfection"
    
    When you ask "what's the nickname?":
    
    1. Check instance â†’ not found
    2. Check reference â†’ "Lucky Wafel" âœ“
    
    When you ask "is it warm?":
    
    1. Check instance â†’ true âœ“

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EMBEDDING IN GAME STATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

embedding:

  principle: |
    You do NOT need individual files for each card instance.
    Pack them ALL into YAML structures!
    
    The game state IS the canonical location for instances.
    References point to definitions.
    Definitions live in packs.
    
  game_state_structure: |
    ```yaml
    # Full game state in one YAML structure
    
    game:
      id: "moollm-ultimate-001"
      timestamp: "2026-01-23T16:00:00Z"
      
      deck:
        index: 47
        cards:
          - ref: "fluxx-4.0:bread"
          - ref: "amsterdam:stroopwafel"
          - ref: "moollm:yaml_jazz"
          # ... just references, resolved on access
          
      players:
        don:
          hand:
            - ref: "fluxx-4.0:draw_2"
            - ref: "moollm:emergence"
            - ref: "amsterdam:cheese_wheel"
              annotations: "Been waiting to play this!"
              
          keepers:
            - inherits: "fluxx-4.0:peace"
              instance_id: "k-001"
              played_at: "hand_2"
              
            - inherits: "moollm:yaml_jazz"
              instance_id: "k-017"
              played_at: "hand_5"
              state:
                k_line_resonance: 1.0
                
        palm:
          hand:
            - ref: "fluxx-4.0:steal_keeper"
            - ref: "consciousness:deep_thoughts"
            
          keepers:
            - inherits: "amsterdam:stroopwafel"
              instance_id: "k-002"
              played_at: "hand_3"
              state:
                warm: true  # On the coffee cup
                
      rules_in_play:
        - inherits: "amsterdam:gezelligheid"
          instance_id: "r-001"
          played_by: "starting"
          
        - inherits: "moollm:chain_of_thought"
          instance_id: "r-002"
          played_by: "bumblewick"
          
      current_goal:
        inherits: "moollm:emergent_behavior"
        instance_id: "g-001"
        
      discard_pile:
        - ref: "fluxx-4.0:rules_reset"  # Just refs, no instance needed
        - ref: "amsterdam:kings_day"
    ```
    
  benefits:
    - "Single file contains entire game state"
    - "References keep it compact"
    - "Instances only where state differs from definition"
    - "Easy to serialize, save, restore"
    - "Diff-friendly for tracking changes"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DYNAMIC CARD CREATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

dynamic_creation:

  when: |
    Cards can be created dynamically when:
    - A special ability triggers ("create a new Keeper")
    - The narrative demands it
    - A player invents something
    - The LLM improvises
    
  how: |
    Just emit a card definition inline!
    
    ```yaml
    card:
      id: "improvised-{timestamp}"
      name: "Whatever Makes Sense"
      type: "keeper|goal|action|rule"
      # ... fill in the rest
      origin:
        created_by: "who"
        created_at: "when"
        reason: "why"
    ```
    
  validation: |
    The LLM (or game engine) validates:
    - Required fields present
    - Type is valid
    - Effects are parseable
    - No id collision
    
  examples:
  
    chip_morningstar_ability: |
      Chip's special ability: "Create a new Keeper from the discard pile"
      
      Don activates Chip Morningstar's ability!
      He looks at the discard pile... and sees Bread.
      "I'm going to turn this Bread into... GRILLED CHEESE."
      
      ```yaml
      card:
        id: "chip-created-grilled-cheese-001"
        name: "Grilled Cheese"
        type: "keeper"
        emoji: "ğŸ§€ğŸ"
        flavor: "Bread evolved. Chip's creation."
        origin:
          created_by: "don"
          using: "chip_morningstar:special_ability"
          from: "fluxx-4.0:bread"
          session: "moollm-ultimate-001"
          timestamp: "2026-01-23T16:15:00Z"
        inherits_from: "fluxx-4.0:bread"  # Optional lineage
        goals_featured_in: []  # New card, no existing goals
      ```
      
      The Grilled Cheese enters play in front of Don!
      
    narrative_emergence: |
      During play, the LLM notices a recurring pattern...
      
      **LLM:** This is the third time Bumblewick has drawn a Creeper
      only to have Palm save him. Let me recognize this pattern:
      
      ```yaml
      card:
        id: "emergent-pattern-unlikely-rescue"
        name: "Unlikely Rescue"
        type: "goal"
        emoji: "ğŸˆğŸâœ¨"
        flavor: "The teacher saves the student. Again."
        requires: [palm, bumblewick]
        special: "Win if Palm has protected Bumblewick from 3+ Creepers this game"
        origin:
          created_by: "narrative_emergence"
          pattern_detected: "palm_protects_bumblewick"
          occurrences: 3
          session: "moollm-ultimate-001"
      ```
      
      This Goal now exists! It reflects the story being told.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CARD IDENTITY
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

identity:

  question: "When is a card the 'same' card?"
  
  answer: |
    DEFINITION identity: Same id in same source
      "amsterdam:stroopwafel" == "amsterdam:stroopwafel"
      
    REFERENCE identity: Same inventory slot
      "palm:inventory:stroopwafel" is Palm's specific stroopwafel
      "don:inventory:stroopwafel" is Don's specific stroopwafel
      (They're both stroopwafels, but different references!)
      
    INSTANCE identity: Same instance_id in game
      "game-001-keeper-017" is THIS specific card on the table
      Even if Palm plays two stroopwafels, they're different instances
      
  implications:
    - "Stealing a Keeper transfers the REFERENCE, not definition"
    - "Copying a card creates a new REFERENCE pointing to same definition"
    - "Annotations travel with REFERENCE (your notes move with your card)"
    - "State is per INSTANCE (warm/not warm is about THIS one)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FULL MOOLLM CARD-SHIP
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

full_cardship:

  declaration: |
    A MOOLLM card is a first-class MOOLLM object.
    
    It has:
    - DEFINITION (type, template, schema)
    - REFERENCE (pointer with annotations)
    - INSTANCE (concrete object in context)
    
    It can be:
    - EMBEDDED in packs (no separate file)
    - INLINE in conversation (YAML data island)
    - DYNAMICALLY GENERATED (LLM creates on the fly)
    - INHERITED from other cards (layers of customization)
    - PLAYED into contexts (games, rooms, conversations)
    
    It does NOT require:
    - Separate CARD.yml file
    - Pre-registration in any index
    - Static definition before game start
    
    It IS:
    - YAML all the way down
    - Comments-as-semantic-data
    - Inspectable, diff-able, hackable
    - Part of the living document
    
  mantra: |
    "A card is a card is a card...
     until you play it. Then it's YOUR card.
     And when it hits the table, it becomes THAT game's card.
     Each layer adds meaning. Each instance adds state.
     The definition is the blueprint.
     The reference is your relationship to it.
     The instance is the moment of play."
