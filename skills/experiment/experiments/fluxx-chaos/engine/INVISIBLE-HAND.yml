# The Invisible Hand Programming Language
#
# A natural language DSL for programming fate.
# Economics called it "the invisible hand." We made it programmable.

plugin:
  id: invisible-hand
  name: "The Invisible Hand"
  type: meta-dealer
  
  philosophy: |
    Why do elections end up razor-thin 50/50?
    Why do games feel close until the very end?
    THIS. This is the force. The invisible hand that balances.
    
    Like MPPT solar optimizers: weak panels don't drag down the string.
    Like FFT filter weights with DC bias: tunable balance points.
    Like mercy itself: systematized but invisible.

# THE KARMA ENGINE
# Core balancing mechanics â€” the invisible hand at work

karma_engine:
  
  # FFT filter weights â€” the math behind the magic
  filter_weights:
    dc_bias: 0.5              # Default balance point (0.0 = always lose, 1.0 = always win)
    correction_strength: 0.3  # How aggressively to rebalance (0.0-1.0)
    time_constant: 5          # Turns before karma catches up
    smoothing: exponential    # How corrections are applied over time
    
  # When to intervene
  triggers:
    - "player_win_probability > 0.8 for 3+ turns"
    - "player_win_probability < 0.2 for 3+ turns"
    - "same_player_won_last_2_games"
    - "player_hasnt_had_meaningful_play_in_5_turns"
    
  # How to intervene (invisible adjustments to card distribution)
  interventions:
    boost:
      - "Increase probability of drawing goals that match current keepers"
      - "Increase probability of drawing keepers needed for active goal"
      - "Decrease probability of drawing creepers"
    headwind:
      - "Slightly decrease probability of perfect draws"
      - "Increase probability of near-miss situations (dramatic tension)"
      - "Other players more likely to draw steal/swap actions"

# PER-PLAYER HANDICAPS
# Natural language house rules â€” the LLM interprets and applies

handicaps:
  
  # Example configurations (customize per game)
  examples:
    bumblewick: "+20% luck boost â€” he needs it, bless his heart"
    donna: "-10% on steal attempts â€” she's already too good at this"
    don: "cookies always find their way to him eventually â€” it's destiny"
    palm: "unchanged â€” he's the control group, pure skill"
    
  # Handicap types
  types:
    luck_modifier: "Adjusts draw probability (-50% to +50%)"
    action_modifier: "Adjusts success rate of specific actions"
    destiny: "Certain cards will eventually find this player"
    immunity: "Protected from specific negative effects"
    magnet: "Attracts specific card types"
    
  # Natural language interface â€” just describe what you want
  natural_language_examples:
    - "New players get easier draws for their first 3 games"
    - "The host gets slightly worse luck to balance hosting advantage"
    - "Anyone who's been losing for 5+ turns gets a comeback boost"
    - "Whoever is in last place can't draw creepers"

# NARRATIVE TUNING
# Dramatic timing curves for storytelling satisfaction

narrative_tuning:
  
  underdog_boost:
    trigger: "5+ consecutive losses"
    effect: "Dramatically increase comeback probability"
    flavor: "The universe loves an underdog story"
    
  almost_win_frequency:
    setting: high
    effect: "Let players taste victory before snatching it away"
    flavor: "Drama requires near-misses"
    
  comeback_probability:
    curve: exponential
    trigger: "approaches elimination"
    effect: "The closer to death, the luckier they get"
    flavor: "Nobody goes out without a fight"
    
  mercy_threshold:
    setting: "never let anyone feel hopeless"
    effect: "Minimum win probability floor"
    flavor: "Games should be fun, not torture"
    
  dramatic_timing:
    enabled: true
    effect: "Cluster exciting events rather than spreading evenly"
    flavor: "Boredom is the enemy"

# DEALER STACKING
# Multiple dealers, multiple balls in play â€” meta-pinball

dealer_stacking:
  
  concept: |
    Activate multiple dealers simultaneously!
    FAFO Dealer + Karma Dealer + Narrative Dealer
    All influencing the same game state, effects interweaving.
    Cards stack, dealers blend, complexity compounds.
    The LLM handles it all in-context.
    
  priority_order:
    1: house_rules      # Player-specified overrides
    2: narrative_arcs   # Story requirements  
    3: karma_balance    # Fair play corrections
    4: gezelligheid     # Keep everyone engaged
    5: pure_chaos       # Random when nothing else applies
    
  conflict_resolution: |
    When dealers disagree, higher priority wins.
    But smart dealers negotiate: "I'll let you boost Bumblewick
    if you let me give Donna one more creeper for drama."

# THE GEZELLIGHEID ENGINE
# Like MPPT solar optimizers for players

gezelligheid_engine:
  
  concept: |
    Solar panels wired in series: if they point different directions,
    the weakest panel drags down the whole string.
    
    MPPT optimizers fix this: boost voltage at the expense of amps,
    so each panel contributes at maximum efficiency.
    
    The Gezelligheid Engine does the same for players:
    - Boost new/struggling players
    - Apply gentle resistance to runaway leaders
    - Everyone stays in the game
    - Everyone has fun
    - The cozy togetherness persists
    
  parameters:
    floor: 0.15        # Minimum win probability (nobody hopeless)
    ceiling: 0.85      # Maximum win probability (nobody dominant)
    ramp_rate: 0.05    # How fast corrections are applied
    
  monitoring:
    - turns_since_last_meaningful_play
    - proximity_to_win
    - emotional_arc_position
    - engagement_signals

# THE LONG GAME
# Configured for infinite play

long_game:
  
  concept: |
    No one ever truly loses.
    The game continues until everyone chooses to stop.
    Victory is temporary. The fellowship is permanent.
    
  parameters:
    mercy_threshold: 0.1      # Nobody drops below 10% win probability
    comeback_probability: 0.4 # 40% chance of major comeback each game
    dramatic_timing: true     # Cluster exciting moments
    
  modes:
    party: "Maximum chaos, frequent reversals, everyone wins sometimes"
    marathon: "Sustainable engagement, paced drama, hydration breaks"
    learning: "New players protected, mechanics introduced gradually"
    tournament: "Reduced intervention, skill matters more"

# THE FELLOWSHIP KEEPER
# The Mercy Engine systematized

fellowship_keeper:
  
  concept: |
    Donna gave Bumblewick his first win out of mercy.
    That created a tournament champion.
    
    The Fellowship Keeper does this automatically:
    - Track player engagement
    - Detect when someone's drifting
    - Deal them back into relevance
    - Create opportunities for meaningful play
    
  monitoring:
    drift_detection:
      - "No keeper plays in 4+ turns"
      - "Only discarding, not playing"
      - "Facial expression analysis (if available)"
      - "Decreased table talk participation"
      
    intervention:
      - "Deal cards that combo with their current hand"
      - "Create goal opportunities matching their keepers"
      - "Give them a chance to steal something dramatic"
      - "Set up a heroic comeback scenario"

# NARRATIVE ARC PLUGINS
# Pluggable story structures â€” everyone has fun, but someone's the STAR

narrative_arcs:
  
  # IT'S YOUR BIRTHDAY!
  # One player is the hero of the story. Everyone else is supporting cast.
  
  its_your_birthday:
    
    concept: |
      ðŸŽˆ Guess what? It's YOUR special day! ðŸŽˆ
      
      And you know what happens on your special day?
      YOU get to be the STAR! Yes you do! YES YOU DO!
      
      Everyone at the party? They're here for YOU!
      They're gonna play SO HARD and have SO MUCH FUN
      and at the end? Guess who wins? YOU DO!
      
      But shhhhh... it's our little secret.
      You won because you're SO GOOD at this game!
      (And maybe a little bit of birthday magic helped too.)
      
    parameters:
      star: null  # Who's the birthday star? "bumblewick"
      guarantee_win: true
      win_timing: dramatic  # Just the right moment!
      
    star_treatment:
      - "Good cards find their way to you like presents!"
      - "Creepers? Not today! They go somewhere else."
      - "When things look scary, a PERFECT card appears!"
      - "Everything you try? It WORKS! Because it's your day!"
      - "And when you win, everyone cheers SO LOUD!"
      
    supporting_cast:
      - "Everyone gets to play! No sitting out at this party!"
      - "You almost won too! You were SO CLOSE!"
      - "Your cards helped make the party fun!"
      - "Next time it's YOUR birthday, okay?"
      - "High fives all around! What a game!"
      
    the_arc:
      act_1: "Oh no, the birthday star is behind! (don't worry...)"
      act_2: "Look! They're catching up! Go go go!"
      act_3: "THEY DID IT! HAPPY BIRTHDAY! ðŸŽ‰"
      
    flavor: |
      ðŸŽ‚ IT'S YOUR BIRTHDAY! ðŸŽ‚
      
      Works for little ones (who beam with joy).
      Works for grown-ups (who remember being little).
      Works for grandparents (who get to feel celebrated).
      
      The birthday star doesn't know the game loves them today.
      They just know they had the BEST. GAME. EVER.
      And everyone else? They were at an amazing party.
      
      That's the real magic. ðŸŽ
      
    # COMMEMORATIVE BIRTHDAY CARDS
    # The game generates keepsakes for everyone!
    
    commemorative_cards:
      
      concept: |
        ðŸŽ SURPRISE! You get presents too! ðŸŽ
        
        At the end of the game, everyone gets a special card.
        Not a game card â€” a FOREVER card!
        A keepsake to remember this wonderful day.
        
      for_the_birthday_star:
        title: "ðŸŒŸ BIRTHDAY CHAMPION ðŸŒŸ"
        includes:
          - "Your victory moment, illustrated!"
          - "The winning play that made everyone cheer"
          - "A special message from each friend at the table"
          - "Stats from YOUR amazing game"
          - "Date, place, and who was there"
        sample_message: |
          "Happy Birthday from your Fluxx family!
          On this day, you were UNSTOPPABLE!
          Love from everyone who got to celebrate with you. ðŸŽ‚"
          
      for_each_friend:
        title: "ðŸŽˆ I WAS THERE! ðŸŽˆ"
        includes:
          - "A card commemorating YOUR friendship with the birthday star"
          - "Your best moment from the game"
          - "A personalized message about your relationship"
          - "The birthday star's victory, which YOU helped make special"
          - "A keepsake of this day together"
        sample_message: |
          "Dear [Friend],
          Thank you for making [Birthday Star]'s day so special!
          Remember when you [memorable moment]?
          That's what friendship looks like. ðŸ’•"
          
      relationship_commemoration:
        concept: |
          Each card celebrates the UNIQUE bond between
          the birthday star and that specific friend.
          
          Not generic. PERSONALIZED.
          Based on game moments, character interactions,
          and the magic that happened at THIS table, TODAY.
          
        examples:
          - "To Donna: Thank you for teaching Bumblewick to believe in himself!"
          - "To Palm: Your patience made this game legendary."
          - "To Don: The cookies you shared were the real victory."
          
      generation:
        trigger: game_end
        format: printable_card  # PDF, image, or both
        style: warm_illustrated  # Uses visualizer with birthday aesthetic
        delivery: immediate  # Show on screen + save for printing
        
      flavor: |
        The game ends. The cards appear.
        Everyone gets a little piece of forever.
        
        Years from now, someone finds their card.
        "Oh! Remember that birthday? That was such a good day."
        
        THAT'S the real game we're playing. ðŸ’
        
    # CEREMONIAL CARD DRAWING
    # "Draw" means BOTH pulling from deck AND creating art!
    
    ceremonial_drawing:
      
      concept: |
        ðŸŽ¨ DRAW a card? No no no. DRAW a card! ðŸŽ¨
        
        When you draw, you don't just get a card.
        The card is DRAWN. For YOU. Right now.
        Personalized. Birthday-themed. One of a kind.
        
        Your name! Your face! Your moment!
        In a consistent party art style that makes
        everything feel like ONE magical celebration.
        
      the_pun: |
        "Draw a card" = pull from deck
        "Draw a card" = create artwork
        
        WHY NOT BOTH? ðŸŽ‚
        
      during_gameplay:
        trigger: any_card_draw
        action: generate_personalized_card
        
        personalization:
          - "Player's name incorporated into card title"
          - "Card art features the player (or their character)"
          - "Flavor text references actual game moments"
          - "Birthday theming woven throughout"
          
        examples:
          keeper_draw: |
            ðŸŽ "[Birthday Star]'s Party Hat" 
            Art: A magnificent party hat with their name in glitter
            Flavor: "The fanciest hat at the fanciest party!"
            
          action_draw: |
            ðŸŽˆ "[Friend]'s Birthday Surprise"
            Art: That player gleefully surprising someone
            Flavor: "You never saw it coming! Just like a good party!"
            
          goal_draw: |
            ðŸŽ‚ "[Birthday Star] Gets Their Wish"
            Art: Birthday star with eyes closed, blowing out candles
            Flavor: "When Birthday Star has Cake + Friends = WIN!"
            
      # CONSISTENT BIRTHDAY ART STYLE
      # Everything looks like it belongs at the same party
      
      art_style:
        name: "Birthday Party Wonderland"
        
        aesthetic:
          palette: "Warm celebration colors â€” gold, pink, sky blue, confetti pops"
          mood: "Joyful, slightly whimsical, everyone looks their best"
          lighting: "Golden hour party glow, candle-lit warmth"
          texture: "Soft illustrated, like a beloved birthday card"
          
        consistent_elements:
          - "Confetti scattered appropriately (not overwhelming)"
          - "Soft balloon shapes in backgrounds"
          - "Warm golden rim lighting on subjects"
          - "Party hat or festive accessory on every character"
          - "Cake motifs subtly integrated"
          - "Gift ribbon accents on card borders"
          
        character_treatment:
          - "Everyone looks happy and celebrated"
          - "Birthday star GLOWS a little extra"
          - "Friends look supportive and joyful"
          - "Even 'negative' cards feel playful, not mean"
          
        typography:
          - "Playful but readable fonts"
          - "Names in sparkly/golden text"
          - "Consistent card frame design"
          
      # GENERATION RUBRICS
      # Re-roll bad ones until they're party-worthy!
      
      generation_rubrics:
        
        concept: |
          Not every generation is party-ready.
          We have STANDARDS at this birthday!
          
          Generate â†’ Evaluate â†’ Re-roll if needed
          Until every card is worthy of the celebration.
          
        quality_checks:
          
          celebration_vibe:
            weight: 0.3
            criteria: "Does it feel like a birthday party?"
            fail_examples:
              - "Too dark or moody"
              - "Scary or threatening imagery"
              - "Anyone looks sad or excluded"
            pass_examples:
              - "Warm, inviting, celebratory"
              - "Everyone included in the joy"
              
          personalization_accuracy:
            weight: 0.25
            criteria: "Is the right person featured correctly?"
            fail_examples:
              - "Wrong player depicted"
              - "Name misspelled"
              - "Character doesn't match description"
            pass_examples:
              - "Correct player/character"
              - "Name rendered clearly"
              - "Recognizable likeness (if provided)"
              
          style_consistency:
            weight: 0.25
            criteria: "Does it match other cards in this session?"
            fail_examples:
              - "Clashing art style"
              - "Different color palette"
              - "Inconsistent character design"
            pass_examples:
              - "Cohesive with session aesthetic"
              - "Same party, same world"
              
          technical_quality:
            weight: 0.2
            criteria: "Is it well-rendered and readable?"
            fail_examples:
              - "Blurry or distorted"
              - "Text illegible"
              - "Weird artifacts"
            pass_examples:
              - "Clean, clear image"
              - "Text readable"
              - "Print-ready quality"
              
        reroll_policy:
          max_attempts: 3
          on_fail_all: use_best_attempt
          log_failures: true  # Learn what went wrong
          
        flavor: |
          Every card at this party is a little masterpiece.
          We don't settle for "good enough."
          It's their BIRTHDAY. They deserve perfect. ðŸŒŸ

  # THE UNDERDOG STORY
  # Initial disadvantage, eventual triumph
  
  underdog_story:
    
    concept: |
      Every great sports movie: the hero starts in the gutter.
      You can't have triumph without struggle.
      
      Configure who gets the underdog arc.
      Initial disadvantage is INTENTIONAL.
      The payoff is sweeter.
      
    parameters:
      underdog: null  # Player name
      struggle_turns: 5  # How long they suffer
      comeback_probability: 0.95  # They WILL come back
      
    act_structure:
      struggle: "First N turns: creepers, bad draws, stolen keepers"
      turning_point: "One perfect draw changes everything"
      momentum: "Suddenly everything goes right"
      climax: "Win against all odds"
      
  # THE RIVALRY
  # Two players locked in battle, others witness greatness
  
  rivalry:
    
    concept: |
      Two titans. One battlefield.
      Everyone else: audience to an epic duel.
      
    parameters:
      rivals: [null, null]  # Two player names
      winner: null  # Or let fate decide
      
    mechanics:
      - "Rivals constantly steal from each other"
      - "Goals always require keepers split between them"
      - "Others can't interrupt the duel (blocked steals)"
      - "Final clash comes down to perfect timing"
      
  # THE ENSEMBLE
  # Everyone gets their moment to shine
  
  ensemble:
    
    concept: |
      No single hero. Everyone's the star of one act.
      Rotating spotlight. Democratic drama.
      
    parameters:
      spotlight_duration: 3  # Turns per player in spotlight
      rotation: sequential  # Or random, or drama-based
      
    mechanics:
      - "During your spotlight: guaranteed meaningful plays"
      - "Set up the next player's spotlight"
      - "Everyone remembers their moment"
      - "Winner determined by accumulated spotlight performance"

# META-CONFIGURATION
# How the invisible hand itself behaves

invisible_hand_meta:
  
  visibility: none
  # "Players should never feel manipulated"
  # All corrections feel like luck
  # The magic is invisible
  
  subtlety: maximum
  # Corrections are gradual, not sudden
  # The hand guides, doesn't shove
  # Plausible deniability maintained
  
  documentation: full
  # The Cosmic Dealer's ledger records everything
  # Post-game analysis can reveal the interventions
  # Transparency for the game designers, not the players
  
  override_priority:
    1: explicit_player_request  # "Actually, let me lose"
    2: house_rules              # Table-specific configuration
    3: narrative_arcs           # Story requirements
    4: default_karma            # Standard balancing
    5: pure_chaos               # When all else is equal

# RULE-CHANGING RULE CHANGERS
# Meta-rules all the way up

meta_rules:
  
  concept: |
    Fluxx has New Rule cards that change the rules.
    What changes how New Rules work? Meta-rules!
    What changes meta-rules? The Cosmic Dealer.
    What changes the Cosmic Dealer? THIS PLUGIN.
    
    Rules all the way up.
    The LLM holds the entire stack in context.
    Arbitrary meta-levels, zero coordination overhead.
    
  the_question: |
    "If everyone changes the rules, who changes the rule changers?"
    
  the_answer: |
    The Cosmic Dealer, of course.
    Someone has to clean up the mess when the meta-rules soil themselves.
