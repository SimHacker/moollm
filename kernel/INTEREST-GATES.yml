# INTEREST-GATES.yml
# Standard Activation Gates for Interests, Objects, and Actions
#
# "An interest is only an interest if you can reach it."
#
# Inspired by: The Sims routing slots, MUD proximity, LambdaMOO



# OVERVIEW
# 
# Interests (objects, skills, characters, actions) have GATES that control:
# 1. VISIBILITY — Can you see/notice this interest?
# 2. ACTIVATION — Can you interact with it?
# 3. EXECUTION — Can you complete the action?
#
# Gates form a hierarchy: world → room → near → touch → self



# PROXIMITY GATES
# Control whether an interest is visible/available based on distance

proximity_gates:
  
  # ALWAYS AVAILABLE
  user:
    scope: "Always available to the user/player"
    examples:
      - "System commands (help, quit, save)"
      - "Player status (inventory, health)"
      - "Meta-actions (look, think)"
    gate: "none — always passes"
    
  in-world:
    scope: "Available anywhere in the current world/adventure"
    examples:
      - "World map"
      - "Global chat channels"
      - "Persistent party members"
    gate: "player.world == interest.world"
    
  # ROOM-BASED
  in-room:
    scope: "Available when in the same room"
    examples:
      - "Objects in the room"
      - "NPCs present"
      - "Exits"
    gate: "player.room == interest.room"
    
  within-room-N:
    scope: "Layered room proximity (1=close, 2=medium, 3=far)"
    examples:
      - "within-room-1: Objects on the table you're at"
      - "within-room-2: Objects across the room"
      - "within-room-3: Objects barely visible in the distance"
    gate: "player.room == interest.room && distance <= N"
    use_case: "Large rooms with sub-areas (ballroom, warehouse)"
    
  # METRIC PROXIMITY
  near:
    scope: "Within specified distance"
    format: "near:Nm or near:Nft"
    examples:
      - "near:1m — arm's reach"
      - "near:3m — conversation distance"
      - "near:10m — across the room"
      - "near:30ft — shouting distance"
    gate: "distance(player, interest) <= N"
    
  adjacent:
    scope: "In an adjacent room (one move away)"
    examples:
      - "Sounds from next room"
      - "Light under the door"
      - "Smell of cooking"
    gate: "rooms_between(player, interest) == 1"
    
  # PHYSICAL CONTACT
  touch:
    scope: "Must be physically touching"
    examples:
      - "Pick lock (touching the lock)"
      - "Read inscription (touching the stone)"
      - "Feel texture"
    gate: "distance(player, interest) == 0"
    
  holding:
    scope: "Must be in player's inventory"
    examples:
      - "Use potion"
      - "Read book"
      - "Wield weapon"
    gate: "interest in player.inventory"
    
  self:
    scope: "Actions on yourself"
    examples:
      - "Check health"
      - "Look at hands"
      - "Think"
    gate: "target == self"



# ACTION GATES
# Control whether specific actions can be executed

action_gates:
  
  # MOVEMENT
  go-to:
    description: "Move to a destination"
    requires:
      proximity: "in-room OR adjacent"
      facing: "Must be facing a routing slot"
      clear_path: "No obstacles blocking"
    routing_slots:
      description: "Valid positions to stand when interacting"
      examples:
        - "In front of a door (to exit)"
        - "Beside a chair (to sit)"
        - "At counter (to order)"
      sims_reference: "The Sims uses these for pathfinding"
    inhibited_by:
      - "Not near enough to target"
      - "Not facing a routing slot"
      - "Path blocked by obstacle"
      - "Destination locked"
      
  enter:
    description: "Enter a room or container"
    requires:
      proximity: "adjacent OR near:1m"
      permission: "Door unlocked or has key"
    inhibited_by:
      - "Door locked"
      - "Too far from entrance"
      - "Entrance blocked"
      
  exit:
    description: "Leave current room"
    requires:
      proximity: "in-room"
      at_exit: "Near an exit"
    
  # INTERACTION
  take:
    description: "Pick up an object"
    requires:
      proximity: "near:1m OR touch"
      takeable: "Object is not fixed"
      capacity: "Inventory has room"
    inhibited_by:
      - "Too far"
      - "Object too heavy"
      - "Object fixed in place"
      - "Inventory full"
      
  use:
    description: "Use an object"
    requires:
      proximity: "Depends on object"
      useable: "Object has use action"
    proximity_examples:
      - "use lamp: near:3m (toggle from across room)"
      - "use terminal: near:1m (need to type)"
      - "use potion: holding (must have in inventory)"
      
  talk:
    description: "Converse with a character"
    requires:
      proximity: "near:3m (conversation distance)"
      available: "Character not busy"
      language: "Shared language"
    inhibited_by:
      - "Too far to hear"
      - "Character busy/sleeping"
      - "No shared language"
      
  examine:
    description: "Look closely at something"
    requires:
      proximity: "near:3m (can see details)"
    detail_levels:
      - "near:10m — general shape, color"
      - "near:3m — features, markings"
      - "near:1m — fine details, text"
      - "touch — texture, hidden features"



# ROUTING SLOTS (The Sims Pattern)
# Positions where an agent can stand to interact with an object

routing_slots:
  
  concept: |
    Objects advertise WHERE you can stand to use them.
    Movement to an object is inhibited if no routing slot is:
    1. Available (not blocked)
    2. Facing you (or you can face it)
    3. Within reach
    
  examples:
    
    door:
      slots:
        - { position: front, facing: door, action: open/close/enter }
        - { position: back, facing: door, action: open/close/exit }
      interactions: [open, close, enter, exit, knock, lock, unlock]
      
    chair:
      slots:
        - { position: front, facing: chair, action: sit }
        - { position: side, facing: chair, action: pull_out }
      interactions: [sit, stand, push_in, pull_out]
      
    counter:
      slots:
        - { position: front, facing: counter, action: use }
      interactions: [order, pay, lean_on, place_item]
      
    bookshelf:
      slots:
        - { position: front, facing: shelf, action: browse }
      interactions: [browse, take_book, return_book, examine]
      
    bed:
      slots:
        - { position: side_left, action: get_in_left }
        - { position: side_right, action: get_in_right }
        - { position: foot, action: make_bed }
      interactions: [sleep, nap, make, sit_on]
      
  blocking: |
    If a routing slot is occupied or blocked:
    - Agent cannot move to that position
    - Must find alternative slot OR wait
    - Some actions may have multiple valid slots



# GATE COMBINATIONS
# Common patterns for composite gates

gate_combinations:
  
  conversation_range:
    gates: ["in-room", "near:3m"]
    meaning: "Close enough to talk without shouting"
    
  interaction_range:
    gates: ["in-room", "near:1m"]
    meaning: "Close enough to touch/manipulate"
    
  visual_range:
    gates: ["in-room OR adjacent"]
    meaning: "Can see through doorways"
    
  shout_range:
    gates: ["in-room OR adjacent", "near:30m"]
    meaning: "Can be heard if shouting"
    
  whisper_range:
    gates: ["in-room", "near:1m"]
    meaning: "Only nearby can hear"



# INTEREST ADVERTISEMENT WITH GATES
# How to declare gates in CARD.yml or object definitions

declaration_format:
  
  example_object: |
    # lamp.yml
    object:
      id: desk-lamp
      name: "Desk Lamp"
      
      interests:
        examine:
          gate: 'near:3m'
          description: "Look at the lamp"
          
        use:
          gate: 'near:1m'
          routing_slots: [front, side]
          description: "Toggle the lamp on/off"
          effect: "Toggles room.lighting"
          
        take:
          gate: 'near:1m'
          inhibited_by: [plugged_in]
          description: "Pick up the lamp"
          
  example_character: |
    # bartender.yml
    character:
      id: bartender
      name: "Sam the Bartender"
      
      interests:
        talk:
          gate: 'near:3m'
          routing_slots: [bar_stool_1, bar_stool_2, bar_stool_3]
          topics: [drinks, rumors, weather, politics]
          
        order:
          gate: 'near:2m'
          routing_slots: [bar_counter]
          requires: [gold >= 1]
          
  example_exit: |
    # ROOM.yml exit definition
    exits:
      north:
        destination: kitchen/
        gate: in-room
        routing_slots: [door_front]
        inhibited_by: [door_locked]
        
      secret_passage:
        destination: hidden-room/
        gate: 'near:1m'
        routing_slots: [behind_bookshelf]
        requires: [bookshelf_moved]
        visible: false  # Hidden until discovered



# GATE EVALUATION
# How the engine processes gates

evaluation:
  
  order:
    1: "Check proximity gate"
    2: "Check routing slot availability"
    3: "Check facing/orientation"
    4: "Check inhibitors (locks, obstacles)"
    5: "Check requirements (keys, skills)"
    
  result:
    pass: "Action available, shown in ADVERTISE"
    fail_proximity: "Interest not shown (too far)"
    fail_routing: "Interest shown, action disabled (can't reach)"
    fail_inhibitor: "Interest shown, action disabled (blocked)"
    fail_requirement: "Interest shown, action disabled (missing requirement)"
    
  feedback:
    good: "Action executes"
    proximity_fail: "You're too far away to [action] the [object]."
    routing_fail: "You can't reach the [object] from here."
    inhibitor_fail: "The [inhibitor] prevents you from [action]."
    requirement_fail: "You need [requirement] to [action] the [object]."



# STANDARD GATE VOCABULARY
# Use these consistently across all skills

vocabulary:
  
  proximity:
    - user        # Always available
    - in-world    # Anywhere in world
    - in-room     # Same room
    - within-room-1  # Close in room
    - within-room-2  # Medium in room
    - within-room-3  # Far in room
    - adjacent    # Next room
    - near:Nm     # Within N meters
    - near:Nft    # Within N feet
    - touch       # Physical contact
    - holding     # In inventory
    - self        # Self-actions
    
  actions:
    - go-to       # Movement
    - enter       # Enter room/container
    - exit        # Leave room
    - take        # Pick up
    - drop        # Put down
    - use         # Interact with
    - examine     # Look closely
    - talk        # Converse
    - give        # Transfer item
    - attack      # Combat
    - open        # Open container/door
    - close       # Close container/door
    - lock        # Lock door
    - unlock      # Unlock door



# SEE ALSO

see_also:
  - "skills/room/CARD.yml — Room definitions"
  - "skills/adventure/CARD.yml — Adventure navigation"
  - "kernel/NAMING.yml — Directories as interests"
  - "The Sims (2000) — Routing slot system"
  - "LambdaMOO — MUD proximity model"
