# MOOLLM URL Scheme
#
# Universal addressing for objects, rooms, characters, skills.
# Round-trip translatable to/from https:// URLs.

scheme: moollm

# ═══════════════════════════════════════════════════════════════════════════════
# ADDRESS SPACE
# ═══════════════════════════════════════════════════════════════════════════════

prefixes:
  
  github:
    pattern: "moollm://github/{org}/{repo}/{path}"
    translates_to: "https://github.com/{org}/{repo}/blob/main/{path}"
    examples:
      - moollm://github/SimHacker/moollm/skills/adventure/CARD.yml
      - moollm://github/leela-ai/central/packages/llm/README.md
    notes:
      - "Default branch assumed 'main', can specify: moollm://github/org/repo@branch/path"
      - "Can address any file or directory"
      - "Fragment addressing: moollm://github/org/repo/file.yml#key.subkey"
      
  local:
    pattern: "moollm://local/{workspace-relative-path}"
    translates_to: "file://{workspace}/{path}"
    examples:
      - moollm://local/skills/adventure/CARD.yml
      - moollm://local/.moollm/session.yml
    notes:
      - "Relative to current workspace root"
      - "Portable between machines if repo structure matches"
      
  moo:
    pattern: "moollm://moo/{service}/{path}"
    reserved: true
    future_services:
      - moollm://moo/lambda/... # Serverless MOO functions
      - moollm://moo/pub/...    # Published content CDN
      - moollm://moo/live/...   # Live multiplayer sessions
      
  pocket:
    pattern: "moollm://pocket/{universe-id}/{path}"
    reserved: true
    notes:
      - "Self-contained universe snapshots"
      - "Can be passed around, forked, merged"
      - "Universe-in-a-pocket"

# ═══════════════════════════════════════════════════════════════════════════════
# FRAGMENT ADDRESSING
# ═══════════════════════════════════════════════════════════════════════════════

fragments:
  yaml_path:
    pattern: "#key.subkey.arrayindex"
    example: "moollm://github/org/repo/characters.yml#npcs.doctor-no.speech"
    
  line_range:
    pattern: "#L10-L20"
    example: "moollm://github/org/repo/SKILL.md#L45-L60"
    
  anchor:
    pattern: "#anchor-name"
    example: "moollm://github/org/repo/README.md#installation"

# ═══════════════════════════════════════════════════════════════════════════════
# ROUND-TRIP TRANSLATION
# ═══════════════════════════════════════════════════════════════════════════════

translation:
  
  moollm_to_https:
    input: "moollm://github/SimHacker/moollm/skills/adventure/CARD.yml"
    output: "https://github.com/SimHacker/moollm/blob/main/skills/adventure/CARD.yml"
    
  https_to_moollm:
    input: "https://github.com/SimHacker/moollm/blob/main/skills/adventure/CARD.yml"
    output: "moollm://github/SimHacker/moollm/skills/adventure/CARD.yml"
    
  raw_github:
    input: "moollm://github/SimHacker/moollm/skills/adventure/CARD.yml"
    raw: "https://raw.githubusercontent.com/SimHacker/moollm/main/skills/adventure/CARD.yml"
    
  images:
    note: "Images can be displayed directly in browser from raw GitHub"
    input: "moollm://github/SimHacker/moollm/examples/adventure-4/images/sign.png"
    raw: "https://raw.githubusercontent.com/SimHacker/moollm/main/examples/adventure-4/images/sign.png"
    html: '<img src="https://raw.githubusercontent.com/SimHacker/moollm/main/examples/adventure-4/images/sign.png">'
    markdown: '![sign](https://raw.githubusercontent.com/SimHacker/moollm/main/examples/adventure-4/images/sign.png)'

# ═══════════════════════════════════════════════════════════════════════════════
# USE IN EXPORTS
# ═══════════════════════════════════════════════════════════════════════════════

export_rendering:
  
  as_link:
    source: "prototype: moollm://github/SimHacker/moollm/archetypes/doctor-no.yml"
    html: '<a href="https://github.com/SimHacker/moollm/blob/main/archetypes/doctor-no.yml">doctor-no.yml</a>'
    
  as_embed:
    source: "include: moollm://github/SimHacker/moollm/archetypes/doctor-no.yml"
    action: "Fetch and inline content at export time"
    
  as_reference:
    source: "see: moollm://github/SimHacker/moollm/archetypes/doctor-no.yml"
    action: "Show preview with link to source"
