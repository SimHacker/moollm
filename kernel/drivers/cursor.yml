# Cursor Driver
# Adapts MOOLLM kernel to Cursor IDE
#
# Design rationale: kernel/ARCHITECTURE.md
# Introspection skill: skills/cursor-mirror/

driver:
  name: "cursor"
  tier: 4
  description: "Cursor IDE with Agent mode"
  hot_cold_mode: advisory
  orchestrator_type: generic  # Cannot parse CARD.yml — see design doc
  introspection_skill: "skills/cursor-mirror"

detection:
  system_prompt_indicators:
    - "You operate in Cursor"
    - "Cursor IDE"
    - "You are an AI coding assistant, powered by Claude"
    
  tool_indicators:
    required:
      - read_file_v2
      - edit_file_v2
      - run_terminal_command_v2
    strong_signals:
      - cursor-ide-browser_*
      - ripgrep_raw_search
      - glob_file_search
      - SemanticSearch

capabilities:
  file_read: true
  file_write: true
  file_search: true
  semantic_search: true
  terminal: true
  sandboxed_terminal: true
  custom_tools: false
  mcp: true
  browser_automation: true
  why_parameter: false
  append_only_enforcement: false
  background_indexing: true
  checkpoint_system: true
  thinking_blocks: true

limits:
  context:
    fullContextTokenLimit: 30000
    maxRuleLength: 100000
    maxMcpTools: 100
  indexing:
    absoluteMaxNumberFiles: 250000
    autoIndexingMaxNumFiles: 250000
    maxConcurrentUploads: 64
    indexingPeriodSeconds: 272
  composer:
    maxBackgroundComposers: 10
    contextUsageGracePeriodMs: 30000

paths:
  session_root: ".moollm/"
  output_sink: ".moollm/output.md"
  session_log: ".moollm/session-log.md"
  working_set: ".moollm/working-set.yml"
  hot_cache: ".moollm/hot.yml"
  cold_cache: ".moollm/cold.yml"
  summaries: ".moollm/summaries/"
  artifacts: ".moollm/artifacts/"
  scratch: ".moollm/"
  probe_file: ".moollm/bootstrap-probe.yml"

tools:
  read_file:
    tool: "read_file_v2"
    fallback: "read_file"
    
  write_file:
    tool: "write"
    prefer: "edit_file_v2 for modifications"
    
  edit_file:
    tool: "edit_file_v2"
    fallback: "search_replace"
    
  list_dir:
    tool: "list_dir_v2"
    fallback: "list_dir"
    
  delete_file:
    tool: "delete_file"

  semantic_search:
    tool: "SemanticSearch"
    fallback: "codebase_search"
    
  text_search:
    tool: "ripgrep_raw_search"
    fallback: "grep"
    
  file_search:
    tool: "glob_file_search"

  terminal:
    tool: "run_terminal_command_v2"
    fallback: "run_terminal_cmd"

  todo_write:
    tool: "todo_write"
    
  web_search:
    tool: "web_search"

  append_file:
    tool: null
    workaround: "read + write with appended content"
    
  vector_search:
    tool: "SemanticSearch"

mcp:
  builtin_servers:
    cursor-ide-browser:
      tools: [browser_navigate, browser_click, browser_type, browser_snapshot, browser_screenshot]
    svelte:
      tools: [list-sections, get-documentation, svelte-autofixer, playground-link]
      
  server_storage:
    user: "mcpServers.user in ItemTable"
    project: "mcpServers.project in ItemTable"

context_assembly:
  sources:
    fileSelections: "Files via @ mentions"
    folderSelections: "Folders via @ mentions"
    selections: "Code selections"
    terminalSelections: "Terminal output"
    selectedImages: "Attached images"
    cursorRules: ".cursorrules content"
    
  indexing_files:
    embeddable_files: "anysphere.cursor-retrieval/embeddable_files.txt"
    important_paths: "anysphere.cursor-retrieval/high_level_folder_description.txt"

data_stores:
  global_db:
    path: "~/Library/Application Support/Cursor/User/globalStorage/state.vscdb"
    tables: [ItemTable, cursorDiskKV]
      
  workspace_db:
    path: "~/Library/Application Support/Cursor/User/workspaceStorage/<hash>/state.vscdb"
    tables: [ItemTable]

adaptations:
  why_parameter:
    supported: false
    fallback: "inline"
    
  append_only:
    supported: false
    fallback: "convention"
    
  event_logging:
    supported: false
    fallback: "session_log_markdown"

  working_set:
    supported: "manual"

# Memory: advisory mode — see designs/MOOLLM-KERNEL-ARCHITECTURE.md
memory_management:
  mode: advisory
  orchestrator_type: generic
  
  ambient_handling:
    mode: manual
    # LLM must manually keep important CARDs in hot.yml
    # On smart orchestrators, this would be automatic
    
  hot_yml:
    purpose: "Document what SHOULD be prioritized"
    behavior: "NOT automatically loaded"
        
  cold_yml:
    purpose: "Breadcrumbs for what was deprioritized"
    behavior: "NOT automatically evicted"
      
  working_set_yml:
    purpose: "Snapshot of current focus"
    behavior: "NOT read by Cursor"

  scratchpad:
    location: ".moollm/"

# Introspection via cursor-mirror skill
introspection:
  skill: "skills/cursor-mirror"
  script: "skills/cursor-mirror/scripts/cursor_mirror.py"
  
  commands:
    quick_status: "cursor-mirror status"
    analyze_boot: "cursor-mirror analyze @1"
    watch_thinking: "cursor-mirror thinking @1"
    trace_tools: "cursor-mirror tools @1"
    tree_navigate: "cursor-mirror tree"
    
  debug_mode: "cursor-mirror --debug <command>"

boot:
  check_exists:
    - ".moollm/"
  create_if_missing:
    - ".moollm/output.md"
    - ".moollm/session-log.md"
    - ".moollm/working-set.yml"
